window.DT_LOCALES={},window.DT_LOCALES.it={SEARCH:"cerca",PER_PAGE:"{NUM} per pagina",SHOWING_TO:"righe da {FROM} a {TO} di {SIZE}",GOTO_FIRST:"vai a pagina 1",GOTO_PREV:"vai a pagina precedente",GOTO_PAGE:"vai a pagina {NUM}",GOTO_NEXT:"vai a pagina successiva",GOTO_LAST:"vai all'ultima pagina",ASC_ACTIVE:"ordine crescente attivo",DESC_ACTIVE:"ordine decrescente attivo",NOT_ACTIVE:"non attivo",NO_RESULT:"nessun risultato"},window.DT_LOCALES.en={SEARCH:"search",PER_PAGE:"{NUM} per page",SHOWING_TO:"rows {FROM} to {TO} of {SIZE}",GOTO_FIRST:"go to page 1",GOTO_PREV:"go to previous page",GOTO_PAGE:"go to page {NUM}",GOTO_NEXT:"go to next page",GOTO_LAST:"go to last page",ASC_ACTIVE:"ascending order active",DESC_ACTIVE:"descending order active",NOT_ACTIVE:"not active",NO_RESULT:"no result"};const DT_LOCALES=window.DT_LOCALES,DT_PREFIX="jtable",DT_TRIGGER=`[data-replace='${DT_PREFIX}']`;class DataTable{constructor(e){this.el=e,this.data=[],this.currPage=1,this.perPage=10,this.locale={}}checkId(){this.el.hasAttribute("id")&&0!=this.el.id.length||(this.el.id=`${DT_PREFIX}-${+new Date}`)}getPgMessage(){let e=(this.currPage-1)*this.perPage+1,t=e+(this.el.querySelectorAll("tbody tr").length-1);document.querySelector(`#${this.el.id}_pgdisplay`).innerHTML=this.locale.SHOWING_TO.replace("{FROM}",e).replace("{TO}",t).replace("{SIZE}",this.data.length)}getData(){let e=[],t=[];return this.el.querySelectorAll("thead th").forEach(e=>t.push(e.innerText)),this.el.querySelectorAll("tbody > tr").forEach(a=>{let i={};a.querySelectorAll("td").forEach((e,a)=>i[t[a]]=e.innerText),e.push(i)}),e}printData(e){let t=this.el.querySelector("tbody");t.innerHTML="",e.forEach(e=>{let a=document.createElement("tr");Object.keys(e).forEach(t=>{let i=document.createElement("td");i.innerText=e[t],a.appendChild(i)}),t.appendChild(a)})}changePage(e){let t=this.perPage*(e-1),a=t+this.perPage,i=this.data.slice(t,a);this.currPage=e,this.printData(i),this.getPgMessage(),this.pagination()}search(e){e=e.toLowerCase().trim();let t=this.data.filter(t=>{let a=!1;for(let i in t)a=a||t[i].toLowerCase().includes(e);return a});if(this.currPage=1,0==t.length){let e=Object.keys(this.data[0]),t=document.createElement("tr"),a=document.createElement("td");a.setAttribute("aria-live","polite"),a.innerHTML=this.locale.NO_RESULT,a.style.textAlign="center",a.colSpan=e.length,t.appendChild(a),this.el.querySelector("tbody").innerHTML="",this.el.querySelector("tbody").appendChild(t)}else this.printData(t.slice(0,this.perPage));this.pagination(),this.getPgMessage()}pagination(){let e=document.createElement("div");e.classList.add(`${DT_PREFIX}__pagination`);let t=Math.ceil(this.data.length/this.perPage);if(this.currPage>1){let t=document.createElement("button");t.setAttribute("aria-controls",this.el.id),t.setAttribute("aria-label",this.locale.GOTO_FIRST),t.innerHTML="&#10094;&#10094;",t.classList.add("btn-char"),t.onclick=(()=>this.changePage(1)),e.appendChild(t);let a=document.createElement("button");a.setAttribute("aria-controls",this.el.id),a.setAttribute("aria-label",this.locale.GOTO_PREV),a.innerHTML="&#10094;",a.classList.add("btn-char"),a.onclick=(()=>this.changePage(this.currPage-1)),e.appendChild(a)}for(let a=this.currPage-2;a<this.currPage+2;a++){if(a<1||a>t)continue;let i=document.createElement("button");i.setAttribute("aria-controls",this.el.id),i.setAttribute("aria-label",this.locale.GOTO_PAGE.replace("{NUM}",a)),i.classList.add("btn"),i.innerHTML=a,a==this.currPage?i.setAttribute("aria-selected",!0):i.onclick=(()=>this.changePage(a)),e.appendChild(i)}if(this.currPage<t){let a=document.createElement("button");a.setAttribute("aria-controls",this.el.id),a.setAttribute("aria-label",this.locale.GOTO_NEXT),a.innerHTML="&#10095;",a.classList.add("btn-char"),a.onclick=(()=>this.changePage(this.currPage+1)),e.appendChild(a);let i=document.createElement("button");i.setAttribute("aria-controls",this.el.id),i.setAttribute("aria-label",this.locale.GOTO_LAST),i.innerHTML="&#10095;&#10095;",i.classList.add("btn-char"),i.onclick=(()=>this.changePage(t)),e.appendChild(i)}document.querySelector(`#${this.el.id}_pagination`).innerHTML="",document.querySelector(`#${this.el.id}_pagination`).appendChild(e)}changeOrder(e,t){let a=this.perPage*(this.currPage-1),i=this.data.length>this.perPage?a+this.perPage:this.data.length,l=this.data.sort((a,i)=>a[e]>i[e]?t:-t);this.printData(l.slice(a,i))}toggleHead(e,t){let a=t.getAttribute("aria-sort")||"";e.forEach(e=>{e.removeAttribute("aria-sort"),e.setAttribute("aria-label",`${e.innerText}: non attivo`)}),0==a.length||"d"==a[0]?(t.setAttribute("aria-sort","ascending"),t.setAttribute("aria-label",`${t.innerText}: ${this.locale.ASC_ACTIVE}`),this.changeOrder(t.innerText,1)):(t.setAttribute("aria-sort","descending"),t.setAttribute("aria-label",`${t.innerText}: ${this.locale.DESC_ACTIVE}`),this.changeOrder(t.innerText,-1))}init(){this.data=this.getData(),this.hasSearch=this.el.dataset.search,this.locale=DT_LOCALES[this.el.dataset.locale],this.checkId(),this.printData(this.data.slice(0,this.perPage));let e=document.createElement("div");e.classList.add(DT_PREFIX);let t=document.createElement("div");t.classList.add(`${DT_PREFIX}__panel`);let a=document.createElement("div"),i=document.createElement("select");i.classList.add(`${DT_PREFIX}__select`);for(let e=1;e<=5;e++)i.innerHTML+=`<option ${1==e?"selected":""} value='${10*e}'>\n                    ${this.locale.PER_PAGE.replace("{NUM}",10*e)}\n                </option>`;if(i.onchange=(()=>{this.perPage=i.value,this.currPage=1,this.printData(this.data.slice(0,this.perPage)),this.pagination(),this.getPgMessage()}),a.appendChild(i),t.appendChild(a),this.hasSearch){let e=document.createElement("div"),a=document.createElement("input");a.setAttribute("aria-controls",this.el.id),a.classList.add(`${DT_PREFIX}__search`),a.setAttribute("role","searchbox"),a.placeholder=this.locale.SEARCH,a.classList.add("control"),a.type="search",a.addEventListener("input",()=>this.search(a.value)),e.appendChild(a),t.appendChild(e)}e.appendChild(t);let l=this.el.querySelectorAll("thead th");l.forEach(e=>{e.setAttribute("tabindex",0),e.setAttribute("scope","col"),e.setAttribute("aria-controls",this.el.id),e.setAttribute("aria-label",`${e.innerText}: ${this.locale.NOT_ACTIVE}`),e.addEventListener("click",()=>this.toggleHead(l,e)),e.addEventListener("keyup",t=>{document.activeElement==e&&"Enter"==t.key&&this.toggleHead(l,e)})});let r=document.createElement("div");r.classList.add(`${DT_PREFIX}__table`),this.el.parentElement.insertBefore(e,this.el),e.appendChild(r),r.appendChild(this.el);let s=document.createElement("div");s.classList.add(`${DT_PREFIX}__panel`);let n=document.createElement("div");n.setAttribute("aria-live","polite"),n.id=`${this.el.id}_pgdisplay`,s.appendChild(n);let c=document.createElement("div");c.id=`${this.el.id}_pagination`,s.appendChild(c),e.appendChild(s),this.pagination(),this.getPgMessage(),this.el.removeAttribute("data-search"),this.el.removeAttribute("data-locale"),this.el.removeAttribute("data-replace")}}document.querySelectorAll(DT_TRIGGER).forEach(e=>new DataTable(e).init());